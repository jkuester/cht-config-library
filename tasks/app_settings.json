{
  "contact_summary": "var ContactSummary = {}; !function(e,t){if('object'==typeof exports&&'object'==typeof module)module.exports=t();else if('function'==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)('object'==typeof exports?exports:e)[n]=r[n]}}(ContactSummary,(()=>{return e={156:e=>{function t(e){return e?Array.isArray(e)?e:[e]:[]}function r(e,t){switch(typeof e){case'undefined':return!0;case'function':return e(t);default:return e}}function n(e,t,n){if(r(e.appliesIf,n)){var o='function'==typeof e.fields?e.fields(n):e.fields.filter((function(e){return r(e.appliesIf,n)})).map((function(e){var t={};return i(e,t,'label'),i(e,t,'value'),i(e,t,'translate'),i(e,t,'filter'),i(e,t,'width'),i(e,t,'icon'),e.context&&(t.context={},i(e.context,t.context,'count'),i(e.context,t.context,'total')),t}));return e.modifyContext&&e.modifyContext(t,n),{label:e.label,fields:o}}function i(e,t,r){switch(typeof e[r]){case'undefined':return;case'function':t[r]=e[r](n);break;default:t[r]=e[r]}}}e.exports=function(e,r,o){var i=e.fields||[],f=e.context||{},c=e.cards||[],a=r&&('contact'===r.type?r.contact_type:r.type),s={cards:[],fields:i.filter((function(e){var r=t(e.appliesToType),n=r.filter((function(e){return e&&'!'===e.charAt(0)}));if((0===r.length||r.includes(a)||n.length>0&&!n.includes('!'+a))&&(!e.appliesIf||e.appliesIf()))return delete e.appliesToType,delete e.appliesIf,!0}))};return c.forEach((function(e){var r,i,c,p,l=t(e.appliesToType);if(l.includes('report')&&l.length>1)throw new Error('You cannot set appliesToType to an array which includes the type \\'report\\' and another type.');if(l.includes('report'))for(r=0;r<o.length;++r)i=o[r],!(p=i)||p.errors&&p.errors.length||(c=n(e,f,i))&&s.cards.push(c);else{if(!l.includes(a)&&l.length>0)return;(c=n(e,f))&&s.cards.push(c)}})),s.context=f,s}},885:(e,t,r)=>{var n=r(972),o=r(156);e.exports=o(n,contact,reports)},972:e=>{e.exports={fields:[],cards:[],context:{}}}},t={},function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(885);var e,t})); return ContactSummary;",
  "tasks": {
    "rules": "(()=>{var e={881:e=>{function t(e,o){var a=Object.keys(e);for(var r in a){var n=a[r];switch(typeof e[n]){case'object':t(e[n],o);break;case'function':e[n]=e[n].bind(o)}}}function o(e){var t=Object.assign({},e),a=Object.keys(t);for(var r in a){var n=a[r];if(Array.isArray(t[n])){t[n]=t[n].slice(0);for(var i=0;i<t[n].length;++i)'object'==typeof t[n][i]&&(t[n][i]=o(t[n][i]))}else'object'==typeof t[n]&&(t[n]=o(t[n]))}return t}e.exports=function(e){var a={};t(e,a),a.definition=o(e)}},130:(e,t,o)=>{var a=o(881);function r(e,t,o,a,r,n){var i=!!n;if(r.contact){var s='contact'===r.contact.type?r.contact.contact_type:r.contact.type,c=i?n.form:s;if(!(e.appliesToType&&e.appliesToType.indexOf(c)<0)&&(!e.appliesIf||e.appliesIf(r,n)))for(var d=i?n:r.contact,p=function(e,t,o){var a;return a='function'==typeof e.idType?e.idType(t,o):'report'===e.idType?o&&o._id:t.contact&&t.contact._id,Array.isArray(a)||(a=[a]),a}(e,r,n),l=!e.passesIf||!!e.passesIf(r,n),f=function(e,t,o,a){if('function'==typeof e.date)return e.date(o,a)||t.now().getTime();if(void 0===e.date||null===e.date||'now'===e.date)return t.now().getTime();if('reported'===e.date)return a?a.reported_date:o.contact.reported_date;throw new Error('Unrecognised value for target.date: '+e.date)}(e,o,r,n),u=e.groupBy&&e.groupBy(r,n),y=0;y<p.length;++y){var _=new t({_id:p[y]+'~'+e.id,contact:r.contact,deleted:!!d.deleted,type:e.id,pass:l,groupBy:u,date:f});e.emitCustom?e.emitCustom(v,_,r,n):v(_)}}function v(e){a('target',e)}}e.exports=function(e,t,o,n,i){for(var s=0;s<e.length;++s){var c=e[s];switch(a(c),c.appliesTo){case'contacts':r(c,n,o,i,t);break;case'reports':for(var d=0;d<t.reports.length;++d){r(c,n,o,i,t,t.reports[d])}break;default:throw new Error('Unrecognised target.appliesTo: '+c.appliesTo)}}}},140:e=>{e.exports={defaultResolvedIf:function(e,t,o,a,r){var n,i;r||(r=Utils);var s=function(e){var t;if(!e||!e.actions)return;return(t=e.actions.find((function(e){return!e.type||'report'===e.type})))&&t.form}(this.definition);if(!s)throw new Error('Could not find the default resolving form!');return n=0,n=t?Math.max(r.addDate(a,-o.start).getTime(),t.reported_date+1):r.addDate(a,-o.start).getTime(),i=r.addDate(a,o.end+1).getTime(),r.isFormSubmittedInWindow(e.reports,s,n,i)}}},870:(e,t,o)=>{var a=o(881),r=o(140);function n(e,t,o,a,r,n){var i;if(e.appliesToType){var s;if('contacts'===e.appliesTo){if(!r.contact)return;s='contact'===r.contact.type?r.contact.contact_type:r.contact.type}else{if(!n)return;s=n.form}if(-1===e.appliesToType.indexOf(s))return}if('scheduled_tasks'===e.appliesTo||!e.appliesIf||e.appliesIf(r,n))if('scheduled_tasks'===e.appliesTo){if(n&&e.appliesIf){if(!n.scheduled_tasks)return;for(i=0;i<n.scheduled_tasks.length;i++)e.appliesIf(r,n,i)&&d(i)}}else d();function c(e,t,o){var a;return(a='function'==typeof e.contactLabel?e.contactLabel(t,o):e.contactLabel)?{name:a}:t.contact}function d(i){var s,d,l,f,u=null;for(s=0;s<e.events.length;s++){if((d=e.events[s]).dueDate)u=d.dueDate(d,r,n,i);else if(n)u=void 0!==i?new Date(t.addDate(new Date(n.scheduled_tasks[i].due),d.days)):new Date(t.addDate(new Date(n.reported_date),d.days));else if(d.dueDate)u=d.dueDate(d,r);else{var y=r.contact&&r.contact.reported_date?new Date(r.contact.reported_date):new Date;u=new Date(t.addDate(y,d.days))}t.isTimely(u,d)&&(f={_id:(n?n._id:r.contact&&r.contact._id)+'~'+(d.id||s)+'~'+e.name,deleted:!(!(r.contact&&r.contact.deleted||n)||!n.deleted),doc:r,contact:c(e,r,n),icon:e.icon,date:u,readyStart:d.start||0,readyEnd:d.end||0,title:e.title,resolved:e.resolvedIf(r,n,d,u,i),actions:p(e.actions,d)},void 0!==i&&(f._id+='-'+i),'function'==typeof(l=e.priority)&&(l=l(r,n)),l&&(f.priority=l.level,f.priorityLabel=l.label),a('task',new o(f)))}}function p(t,o){return e.actions.map((function(e){return function(e,t){var o={source:'task',source_id:n?n._id:r.contact&&r.contact._id,contact:r.contact};e.modifyContent&&e.modifyContent(o,r,n,t);return{type:e.type||'report',form:e.form,label:e.label||'Follow up',content:o}}(e,o)}))}}e.exports=function(e,t,o,i,s){if(e)for(var c,d,p=0;p<e.length;++p)switch('function'!=typeof(c=Object.assign({},e[p],r)).resolvedIf&&(c.resolvedIf=function(e,t,a,r){return c.defaultResolvedIf(e,t,a,r,o)}),a(c),c.appliesTo){case'reports':case'scheduled_tasks':for(var l=0;l<t.reports.length;++l)d=t.reports[l],n(c,o,i,s,t,d);break;case'contacts':t.contact&&n(c,o,i,s,t);break;default:throw new Error('Unrecognised task.appliesTo: '+c.appliesTo)}}},931:e=>{e.exports=[]},991:e=>{e.exports=[{name:'report_task',title:'Task for report',appliesTo:'reports',appliesToType:['trigger_report_task'],events:[{id:'report_task_event_id',days:0,start:0,end:1}],actions:[{type:'report',form:'resolve_report_task',label:'Resolve Task Form',modifyContent:(e,t,o,a)=>{e.from_modify_content={event_id:a.id,source_form:o.form}}}]},{name:'contact_task',title:'Task for contact',appliesTo:'contacts',appliesToType:['person'],events:[{id:'contact_task_event_id',days:0,start:0,end:1}],actions:[{type:'report',form:'resolve_contact_task',label:'Resolve Task Form',modifyContent:(e,t,o,a)=>{e.from_modify_content={event_id:a.id}}}]},{name:'add_household_members_task',title:'Add Household Members',appliesTo:'contacts',appliesToType:['clinic'],events:[{id:'add_household_members_task_event_id',days:0,start:0,end:1}],actions:[{type:'contact',label:'Add person to household',modifyContent:(e,{contact:t})=>{e.type='person',e.parent_id=t._id}},{type:'report',form:'mark_household_complete',label:'No more household members to add'}]},{name:'add_role_task',title:'Add Role',appliesTo:'contacts',appliesToType:['person'],events:[{id:'add_role_event_id',days:0,start:0,end:1}],appliesIf:({contact:e})=>!e.role||!e.role.length,resolvedIf:()=>!1,actions:[{type:'contact',modifyContent:(e,{contact:t})=>{e.edit_id=t._id}}]}]}},t={};function o(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,o),n.exports}var a=o(991),r=o(931),n=o(870);o(130)(r,c,Utils,Target,emit),n(a,c,Utils,Task,emit),emit('_complete',{_id:!0})})();",
    "isDeclarative": true,
    "targets": {
      "enabled": true,
      "items": []
    }
  }
}
