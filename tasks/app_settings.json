{
  "contact_summary": "var ContactSummary = {}; !function(e,t){if('object'==typeof exports&&'object'==typeof module)module.exports=t();else if('function'==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)('object'==typeof exports?exports:e)[n]=r[n]}}(ContactSummary,(()=>{return e={115:(e,t,r)=>{var n=r(972),o=r(610);e.exports=o(n,contact,reports)},610:e=>{function t(e){return e?Array.isArray(e)?e:[e]:[]}function r(e,t){switch(typeof e){case'undefined':return!0;case'function':return e(t);default:return e}}function n(e,t,n){if(r(e.appliesIf,n)){var o='function'==typeof e.fields?e.fields(n):e.fields.filter((function(e){return r(e.appliesIf,n)})).map((function(e){var t={};return i(e,t,'label'),i(e,t,'value'),i(e,t,'translate'),i(e,t,'filter'),i(e,t,'width'),i(e,t,'icon'),e.context&&(t.context={},i(e.context,t.context,'count'),i(e.context,t.context,'total')),t}));return e.modifyContext&&e.modifyContext(t,n),{label:e.label,fields:o}}function i(e,t,r){switch(typeof e[r]){case'undefined':return;case'function':t[r]=e[r](n);break;default:t[r]=e[r]}}}e.exports=function(e,r,o){var i=e.fields||[],f=e.context||{},c=e.cards||[],a=r&&('contact'===r.type?r.contact_type:r.type),s={cards:[],fields:i.filter((function(e){var r=t(e.appliesToType),n=r.filter((function(e){return e&&'!'===e.charAt(0)}));if((0===r.length||r.includes(a)||n.length>0&&!n.includes('!'+a))&&(!e.appliesIf||e.appliesIf()))return delete e.appliesToType,delete e.appliesIf,!0}))};return c.forEach((function(e){var r,i,c,p,l=t(e.appliesToType);if(l.includes('report')&&l.length>1)throw new Error('You cannot set appliesToType to an array which includes the type \\'report\\' and another type.');if(l.includes('report'))for(r=0;r<o.length;++r)i=o[r],!(p=i)||p.errors&&p.errors.length||(c=n(e,f,i))&&s.cards.push(c);else{if(!l.includes(a)&&l.length>0)return;(c=n(e,f))&&s.cards.push(c)}})),s.context=f,s}},972:e=>{e.exports={fields:[],cards:[],context:{}}}},t={},function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(115);var e,t})); return ContactSummary;",
  "tasks": {
    "rules": "(()=>{var t={0:(t,e,o)=>{var r=o(847),a=o(94);function n(t,e,o,r,a,n){var i;if(t.appliesToType){var c;if('contacts'===t.appliesTo){if(!a.contact)return;c='contact'===a.contact.type?a.contact.contact_type:a.contact.type}else{if(!n)return;c=n.form}if(-1===t.appliesToType.indexOf(c))return}if('scheduled_tasks'===t.appliesTo||!t.appliesIf||t.appliesIf(a,n))if('scheduled_tasks'===t.appliesTo){if(n&&t.appliesIf){if(!n.scheduled_tasks)return;for(i=0;i<n.scheduled_tasks.length;i++)t.appliesIf(a,n,i)&&d(i)}}else d();function s(t,e,o){var r;return(r='function'==typeof t.contactLabel?t.contactLabel(e,o):t.contactLabel)?{name:r}:e.contact}function d(i){var c,d,f,l,u=null;for(c=0;c<t.events.length;c++){if((d=t.events[c]).dueDate)u=d.dueDate(d,a,n,i);else if(n)u=void 0!==i?new Date(e.addDate(new Date(n.scheduled_tasks[i].due),d.days)):new Date(e.addDate(new Date(n.reported_date),d.days));else if(d.dueDate)u=d.dueDate(d,a);else{var v=a.contact&&a.contact.reported_date?new Date(a.contact.reported_date):new Date;u=new Date(e.addDate(v,d.days))}e.isTimely(u,d)&&(l={_id:(n?n._id:a.contact&&a.contact._id)+'~'+(d.id||c)+'~'+t.name,deleted:!(!(a.contact&&a.contact.deleted||n)||!n.deleted),doc:a,contact:s(t,a,n),icon:t.icon,date:u,readyStart:d.start||0,readyEnd:d.end||0,title:t.title,resolved:t.resolvedIf(a,n,d,u,i),actions:p(t.actions,d)},void 0!==i&&(l._id+='-'+i),'function'==typeof(f=t.priority)&&(f=f(a,n)),f&&(l.priority=f.level,l.priorityLabel=f.label),r('task',new o(l)))}}function p(e,o){return t.actions.map((function(t){return function(t,e){var o={source:'task',source_id:n?n._id:a.contact&&a.contact._id,contact:a.contact};t.modifyContent&&t.modifyContent(o,a,n,e);return{type:t.type||'report',form:t.form,label:t.label||'Follow up',content:o}}(t,o)}))}}t.exports=function(t,e,o,i,c){if(t)for(var s,d,p=0;p<t.length;++p)switch('function'!=typeof(s=Object.assign({},t[p],a)).resolvedIf&&(s.resolvedIf=function(t,e,r,a){return s.defaultResolvedIf(t,e,r,a,o)}),r(s),s.appliesTo){case'reports':case'scheduled_tasks':for(var f=0;f<e.reports.length;++f)d=e.reports[f],n(s,o,i,c,e,d);break;case'contacts':e.contact&&n(s,o,i,c,e);break;default:throw new Error('Unrecognised task.appliesTo: '+s.appliesTo)}}},94:t=>{t.exports={defaultResolvedIf:function(t,e,o,r,a){var n,i;a||(a=Utils);var c=function(t){var e;if(!t||!t.actions)return;return(e=t.actions.find((function(t){return!t.type||'report'===t.type})))&&e.form}(this.definition);if(!c)throw new Error('Could not find the default resolving form!');return n=0,n=e?Math.max(a.addDate(r,-o.start).getTime(),e.reported_date+1):a.addDate(r,-o.start).getTime(),i=a.addDate(r,o.end+1).getTime(),a.isFormSubmittedInWindow(t.reports,c,n,i)}}},652:(t,e,o)=>{var r=o(847);function a(t,e,o,r,a,n){var i=!!n;if(a.contact){var c='contact'===a.contact.type?a.contact.contact_type:a.contact.type,s=i?n.form:c;if(!(t.appliesToType&&t.appliesToType.indexOf(s)<0)&&(!t.appliesIf||t.appliesIf(a,n)))for(var d=i?n:a.contact,p=function(t,e,o){var r;return r='function'==typeof t.idType?t.idType(e,o):'report'===t.idType?o&&o._id:e.contact&&e.contact._id,Array.isArray(r)||(r=[r]),r}(t,a,n),f=!t.passesIf||!!t.passesIf(a,n),l=function(t,e,o,r){if('function'==typeof t.date)return t.date(o,r)||e.now().getTime();if(void 0===t.date||null===t.date||'now'===t.date)return e.now().getTime();if('reported'===t.date)return r?r.reported_date:o.contact.reported_date;throw new Error('Unrecognised value for target.date: '+t.date)}(t,o,a,n),u=t.groupBy&&t.groupBy(a,n),v=0;v<p.length;++v){var y=new e({_id:p[v]+'~'+t.id,contact:a.contact,deleted:!!d.deleted,type:t.id,pass:f,groupBy:u,date:l});t.emitCustom?t.emitCustom(_,y,a,n):_(y)}}function _(t){r('target',t)}}t.exports=function(t,e,o,n,i){for(var c=0;c<t.length;++c){var s=t[c];switch(r(s),s.appliesTo){case'contacts':a(s,n,o,i,e);break;case'reports':for(var d=0;d<e.reports.length;++d){a(s,n,o,i,e,e.reports[d])}break;default:throw new Error('Unrecognised target.appliesTo: '+s.appliesTo)}}}},847:t=>{function e(t,o){var r=Object.keys(t);for(var a in r){var n=r[a];switch(typeof t[n]){case'object':e(t[n],o);break;case'function':t[n]=t[n].bind(o)}}}function o(t){var e=Object.assign({},t),r=Object.keys(e);for(var a in r){var n=r[a];if(Array.isArray(e[n])){e[n]=e[n].slice(0);for(var i=0;i<e[n].length;++i)'object'==typeof e[n][i]&&(e[n][i]=o(e[n][i]))}else'object'==typeof e[n]&&(e[n]=o(e[n]))}return e}t.exports=function(t){var r={};e(t,r),r.definition=o(t)}},931:t=>{t.exports=[]},991:t=>{t.exports=[{name:'report_task',title:'Task for report',appliesTo:'reports',appliesToType:['trigger_report_task'],events:[{id:'report_task_event_id',days:0,start:0,end:1}],actions:[{type:'report',form:'resolve_report_task',label:'Resolve Task Form',modifyContent:(t,e,o,r)=>{t.from_modify_content={event_id:r.id,source_form:o.form}}}]},{name:'contact_task',title:'Task for contact',appliesTo:'contacts',appliesToType:['person'],events:[{id:'contact_task_event_id',days:0,start:0,end:1}],actions:[{type:'report',form:'resolve_contact_task',label:'Resolve Task Form',modifyContent:(t,e,o,r)=>{t.from_modify_content={event_id:r.id}}}]}]}},e={};function o(r){var a=e[r];if(void 0!==a)return a.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,o),n.exports}var r=o(991),a=o(931),n=o(0);o(652)(a,c,Utils,Target,emit),n(r,c,Utils,Task,emit),emit('_complete',{_id:!0})})();",
    "isDeclarative": true,
    "targets": {
      "enabled": true,
      "items": []
    }
  }
}
